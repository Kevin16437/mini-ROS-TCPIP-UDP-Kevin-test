# 模拟ROS使用TCP/IP实现远程桌面的网络传输实验

## 实验一：概述

### 1.1 实验目的
1. 理解和掌握Socket编程的基本原理
2. 学习TCP/IP和UDP协议在实际应用中的使用
3. 模拟ROS（Robot Operating System）的发布-订阅模式
4. 实现一个简单的远程桌面控制系统
5. 掌握多线程编程和网络通信的综合应用

### 1.2 实验环境
- 操作系统：Windows 11
- 编程语言：Python 3.8+
- 开发工具：Visual Studio Code 或 PyCharm
- 必需库：opencv-python, numpy, pyautogui, pillow, tkinter

### 1.3 实验原理

#### 1.3.1 ROS架构模拟
ROS采用发布-订阅（Publish-Subscribe）模式进行通信。本实验将模拟这种架构：
- **节点（Node）**：独立运行的进程，负责特定功能
- **话题（Topic）**：节点间通信的通道
- **消息（Message）**：节点间传递的数据

#### 1.3.2 网络协议选择
- **TCP协议**：用于传输屏幕图像数据，保证数据的完整性和顺序
- **UDP协议**：用于传输鼠标控制命令，提供低延迟的实时控制

#### 1.3.3 系统架构
```
┌─────────────────┐         TCP/IP          ┌─────────────────┐
│   服务端节点    │ ◄──────────────────────► │   客户端节点    │
│  (屏幕捕获)    │         (图像数据)       │  (显示控制)    │
│                 │                          │                 │
│                 │          UDP             │                 │
│  (命令执行)    │ ◄──────────────────────  │  (命令发送)    │
└─────────────────┘      (控制命令)         └─────────────────┘
```

## 实验二：系统设计

### 2.1 模块设计

#### 2.1.1 核心框架模块（ros_simulator.py）
- 模拟ROS的节点管理
- 提供话题发布和订阅机制
- 管理网络连接

#### 2.1.2 服务端模块（screen_capture_node.py）
- 屏幕捕获功能
- 图像压缩和发送
- 控制命令接收和执行

#### 2.1.3 客户端模块（remote_viewer_node.py）
- 图像接收和显示
- 鼠标事件捕获
- 控制命令发送

### 2.2 通信协议设计

#### 2.2.1 图像传输协议（TCP）
```
[4字节：图像大小] + [N字节：JPEG压缩图像数据]
```

#### 2.2.2 控制命令协议（UDP）
```json
{
    "type": "mouse_move/mouse_click/mouse_double_click/keyboard",
    "x": 坐标X,
    "y": 坐标Y,
    "button": "left/right/middle",
    "key": "键盘按键"
}
```

## 实验三：代码实现

### 3.1 安装依赖
创建requirements.txt文件，包含所需的Python包。

### 3.2 实现ROS模拟框架
创建基础的节点管理和消息传递框架。

### 3.3 实现服务端
实现屏幕捕获和控制命令执行功能。

### 3.4 实现客户端
实现图像显示和控制命令发送功能。

## 实验四：运行步骤

### 4.1 环境准备
1. 安装Python 3.8或更高版本
2. 使用pip安装依赖包：
   ```bash
   pip install opencv-python numpy pyautogui pillow
   ```

### 4.2 启动服务端
1. 打开终端，进入项目目录
2. 运行服务端程序：
   ```bash
   python screen_capture_node.py
   ```
3. 服务端将显示启动信息，等待客户端连接

### 4.3 启动客户端
1. 打开新的终端窗口
2. 运行客户端程序：
   ```bash
   python remote_viewer_node.py
   ```
3. 客户端窗口将显示远程屏幕内容

### 4.4 测试功能
1. 在客户端窗口中移动鼠标，观察服务端鼠标是否同步移动
2. 点击客户端窗口，测试点击功能
3. 双击测试双击功能

## 实验五：性能优化

### 5.1 图像压缩优化
- 调整JPEG压缩质量参数
- 实现帧率控制
- 使用增量更新减少传输数据

### 5.2 网络优化
- 实现连接池管理
- 添加心跳检测机制
- 实现断线重连功能

### 5.3 并发处理
- 使用线程池处理多个连接
- 异步处理图像编码和网络传输

## 实验六：扩展功能

### 6.1 键盘控制
添加键盘事件的捕获和传输功能。

### 6.2 多客户端支持
实现一个服务端支持多个客户端同时连接。

### 6.3 加密传输
使用SSL/TLS加密网络传输数据。

### 6.4 录制和回放
添加操作录制和回放功能。

## 实验七：故障排除

### 7.1 常见问题

#### 问题1：连接失败
- 检查防火墙设置
- 确认IP地址和端口配置正确
- 检查网络连接状态

#### 问题2：画面卡顿
- 降低图像质量
- 减少传输帧率
- 检查网络带宽

#### 问题3：控制延迟
- 优化UDP包大小
- 使用更高效的序列化方法
- 减少中间处理步骤

### 7.2 调试技巧
1. 使用日志记录关键操作
2. 添加性能计时器
3. 使用网络抓包工具分析数据传输

## 实验八：实验报告要求

### 8.1 报告内容
1. 实验目的和原理说明
2. 系统设计和实现过程
3. 关键代码分析
4. 测试结果和性能分析
5. 遇到的问题和解决方案
6. 实验心得和改进建议

### 8.2 提交材料
1. 完整的源代码
2. 实验报告（Word或PDF格式）
3. 运行截图和演示视频
4. 性能测试数据

## 实验九：评分标准

| 评分项目 | 分值 | 要求 |
|---------|------|------|
| 基本功能实现 | 40分 | 完成屏幕传输和鼠标控制 |
| 代码质量 | 20分 | 代码规范、注释完整 |
| 性能优化 | 15分 | 实现至少两项优化措施 |
| 扩展功能 | 15分 | 实现至少一项扩展功能 |
| 实验报告 | 10分 | 报告完整、分析深入 |

## 实验十：参考资料

1. Python Socket编程官方文档
2. TCP/IP协议详解
3. ROS官方文档（了解架构设计）
4. OpenCV图像处理文档
5. PyAutoGUI自动化控制文档

---

**注意事项：**
1. 本实验仅用于学习目的，请勿用于非法用途
2. 运行程序需要管理员权限
3. 建议在虚拟机或测试环境中进行实验
4. 注意保护个人隐私和数据安全 